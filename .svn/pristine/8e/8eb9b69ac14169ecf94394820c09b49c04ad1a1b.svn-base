package com.desksoft.wechat.service;

import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.Socket;
import java.net.SocketException;
import java.net.UnknownHostException;
import java.text.SimpleDateFormat;
import java.util.Date;

public class TCPServer {
	
	  public static void main(String[] args) {  
			//户号
			String userNo = "5962";
	        String sendData= getSenderStrData(userNo);
	        
	        byte[] data = sendData.getBytes();  
	        Socket socket = null;  
 	        try {  
 	            socket = new Socket("60.190.200.54", 8002);  
 	              System.out.println("send:"+sendData);
 	           // System.out.println("Connected to server ... sending echo string");  
 	  
 	            InputStream in = socket.getInputStream();  
 	            OutputStream out = socket.getOutputStream();  
 	            out.write(data);  
 	  
 	            // receive  
 	            int totalBytesRcvd = 0;// total bytes received so far  
 	            int bytesRcvd;// Bytes received in last read  
 	  
 	            while (totalBytesRcvd < data.length) {  
 	                bytesRcvd = in.read(data, totalBytesRcvd, data.length - totalBytesRcvd);  
 	                if (bytesRcvd == -1) {  
 	                    throw new SocketException("Connection closed prematurely");  
 	                }  
 	                totalBytesRcvd += bytesRcvd;  
 	            }  
 	            System.out.println( "recv:"+new String(data));  
 	  
 	        } catch (UnknownHostException e) {  
 	            e.printStackTrace();  
 	        } catch (IOException e) {  
 	            e.printStackTrace();  
 	        } finally {  
 	            try {  
 	                if (socket != null) {  
 	                    socket.close();  
 	                }  
 	            } catch (IOException e) {  
 	                e.printStackTrace();  
 	            }  
 	        }  
	  
	    }  
	  

	// 用户信息查询
	public static String  getSenderStrData(String userNo){
		//银行代码
		String bankCode = "SZWX01";
		//交易码
		String code = "1002";
		//交易日期
		SimpleDateFormat sdf=new SimpleDateFormat("yyyyMMdd");
		String time=sdf.format(new Date());
		//报文长度 自动填充12位
		 String strLength = String.format("%012d", userNo.length());
		 //System.out.println(strLength);
		//报文头
		String senderHead = code+bankCode+time+strLength+"000000000000"+"  "+"                  ";
		System.out.println(senderHead.length());
		String senderStr = senderHead+"|"+userNo;
		//System.out.println(senderStr);
		return senderStr;
	}
}
