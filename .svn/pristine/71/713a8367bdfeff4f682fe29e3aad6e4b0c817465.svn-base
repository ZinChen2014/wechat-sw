package com.desksoft.wechat.controller.weixin;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import org.apache.commons.lang.StringUtils;

import com.alibaba.fastjson.JSON;
import com.alibaba.fastjson.JSONObject;
import com.desksoft.wechat.common.model.User;
import com.desksoft.wechat.common.model.UserBindFlow;
import com.desksoft.wechat.controller.BaseController;

public class MyUserWaterController extends BaseController {
	

	
	
	/**
	 * 加载我的用水列表
	 */
	public void getUsedWaterList(){
		String openId = getPara("openId",null);
		if(StringUtils.isNotBlank(openId)){
			List<Map<String,Object>> rlist = new ArrayList<Map<String,Object>>();
			List<UserBindFlow> list = UserBindFlow.me.selectBindingUserList(openId);
			
			for(UserBindFlow userBindFlow:list){
				 //TODO 调用 水务接口，根据openID，找到绑定的所有户号，每个户号去调用接口
				//Integer userNo = userBindFlow.getUserNo();
				//假设调用接口，返回用水信息usedList
				List<Map<String,String>> usedList = new ArrayList<Map<String,String>>();
				Map<String,String> wtMap = new HashMap<String,String>();
				wtMap.put("month", "201512");//月份
				wtMap.put("ago", "110");//上期数
				wtMap.put("now", "120");//本期数
				wtMap.put("real", "120");//实抄数
				wtMap.put("should", "120");//应收数
				wtMap.put("fee", "120");//金额
				wtMap.put("fund", "120");//违约金
				wtMap.put("isPay", "1");//是否缴费1,0
				Map<String,String> wtMap2 = new HashMap<String,String>();
				wtMap2.put("month", "201511");//月份
				wtMap2.put("ago", "110");//上期数
				wtMap2.put("now", "120");//本期数
				wtMap2.put("real", "120");//实抄数
				wtMap2.put("should", "120");//应收数
				wtMap2.put("fee", "120");//金额
				wtMap2.put("fund", "120");//违约金
				wtMap2.put("isPay", "1");//是否缴费1,0
				usedList.add(wtMap2);
				usedList.add(wtMap);
				Map<String,Object> map = new HashMap<String,Object>();
				//绑定人信息
				map.put("userBindFlow", userBindFlow);
				//该用户用水信息
				map.put("usedList", usedList);
				rlist.add(map);
			}
			
			if(list.size()>0){
				setAttr("objList", rlist);
				render("myUsedWater.html");
			}else{
				render("addUser.html");
			}
				
		}else{
			renderText("非法URL");
		}
		
	}
	
}
