package com.desksoft.wechat.service;

import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.HashMap;
import java.util.Map;

import com.desksoft.wechat.common.model.User;
import com.desksoft.wechat.weixin.template.DataItem;
import com.desksoft.wechat.weixin.template.TempItem;
import com.desksoft.wechat.weixin.template.TempToJson;
import com.jfinal.weixin.sdk.api.ApiResult;
import com.jfinal.weixin.sdk.api.TemplateMsgApi;

// 推送服务  
public class LargeMsgService {
	
	
	/**
	 * 发送每月的用水情况
	 */
	public void sendMonthInfo(User user){
		
		// @ TODO 调用接口 
		
		DataItem dataItem=new DataItem();
		dataItem.setKeyword1(new TempItem("欠费停水","#FF0000"));
		SimpleDateFormat sdf=new SimpleDateFormat("yyyy年MM月dd日  HH时mm分ss秒");
		String time=sdf.format(new Date());
		dataItem.setKeyword2(new TempItem(time, "#0000FF"));
		dataItem.setKeyword3(new TempItem("电风扇发顺","#FF0000"));
		dataItem.setRemark(new TempItem("您的订单已提交，我们将尽快发货，祝生活愉快", "#008000"));
		
		String json=TempToJson.getTempJson("oa5uZuEm53BTuVGJhdYWlwFITMqg", "BfkzuC__ueuJkF84cPup-27OnSlq1fYrDUFBdmBU2uY",
				"#FF0000", "", dataItem);
		System.out.println(json);
		

		ApiResult apiResult = TemplateMsgApi.send(json);
		System.out.println(apiResult.getJson());
		
	}
	
	//停水信息
	public static Map<String,Object> WaterShutoffNotic(DataItem dataItem,String moudleId){
		
		Map<String,Object> map = new HashMap<String,Object>();
		
		// @ TODO 调用接口 
		
		//获取分批所有的绑定自来水户号的且关注微信的用户，分别给他们微信号发送
				//停水消息
		String openId="";
		//生成群发模板
		String json=TempToJson.getTempJson(openId, moudleId,"#FF0000", "", dataItem);
		System.out.println(json);
		
		ApiResult apiResult = TemplateMsgApi.send(json);
		System.out.println(apiResult.getJson());
		
		return map;
	}
	

	/**
	 * 停水模板
	 * @return
	 */
	public static DataItem getShutOffWaterMudle(String keyword1,String keyword2,String keyword3,String remark){
		DataItem dataItem=new DataItem();
		dataItem.setKeyword1(new TempItem(keyword1,"#FF0000"));
		//SimpleDateFormat sdf=new SimpleDateFormat("yyyy年MM月dd日  HH时mm分ss秒");
		//String time=sdf.format(new Date());
		dataItem.setKeyword2(new TempItem(keyword2, "#0000FF"));
		dataItem.setKeyword3(new TempItem(keyword3,"#FF0000"));
		dataItem.setRemark(new TempItem(remark, "#008000"));
		return dataItem;
	}
	
}
