package com.desksoft.wechat.common.model;

import java.text.DateFormat;
import java.util.Date;
import java.util.List;

import org.apache.commons.lang.StringUtils;

import com.desksoft.wechat.common.model.base.BaseUserbindflow;
import com.jfinal.plugin.activerecord.Page;

@SuppressWarnings("serial")
public class UserBindFlow extends BaseUserbindflow<UserBindFlow> {
	
	public static final UserBindFlow me = new UserBindFlow();
	public static final int IS_DELETE_NO = 0;
	
	public Page<UserBindFlow> getBindingUserPaginateList(int pageNumber, int pageSize,Date startDate,Date endDate,int userNo) {
		String SQL = "from UserBindFlow where isdelete = 1 ";
		if(startDate!=null){
			SQL += " and createTime > '" + DateFormat.getDateInstance().format(startDate)+"'" ;
		}
		if(endDate!=null){
			SQL += " and createTime < '" + DateFormat.getDateInstance().format(endDate) +"'" ;
		}
		if(userNo>0){
			SQL += " and userNo =" + userNo  ;
		}
		SQL +=" order by id asc";
		return paginate(pageNumber, pageSize, "select *", SQL);
	}
	
	public boolean delBindingUser(Object idValue){
		return me.findById(idValue).set("isDelete", IS_DELETE_NO).update();
	}
	
	public boolean isBindingUser(String openid){
		if(StringUtils.isNotBlank(openid)){
			List<UserBindFlow> list = selectBindingUserList(openid);
			if(list.size()>0){
				return true;
			}
		}	
		return false;
	}
	
	public List<UserBindFlow> selectBindingUserList(String openid){
		List<UserBindFlow> list = me.find("select * from UserBindFlow where openID=? and isdelete=1 and isBinding=1", openid);
		return list;
	}
	
}
