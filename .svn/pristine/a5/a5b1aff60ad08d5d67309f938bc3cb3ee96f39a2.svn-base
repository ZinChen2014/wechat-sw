var href ="";
var openId ="";
$(function() {
	$("#fsubmit").click(function() {submit()})
	var url = decodeURI(location.href);

	var index = url.indexOf("/pages/user/");
	var data = getQueryStringValue(url, 'data');
	href = url.substring(0,index);
	openId = jQuery.parseJSON(data).openId;
})
function submit(){
	  if(check_login()&&checkOpenID(openId)){
		  var userno = $.trim($('#userno').val());
		  var mobileno = $.trim($('#mobileno').val());
    	  var d ={
    			 // "openId":openId,
       			  "userno":userno
       			 // "mobileno":mobileno
       			 }
    	  $.ajax({
    		  	 dataType : "json",
                 type : 'post',
                 data: d,
                 url : href+"/bindingUser/isExstBind/json",
                 success : function(obj) {
                     if(true==obj.flag){
                   	  window.location.href=href+"/bindingUser/" +
                   	  		"toBind/?openId="+openId+"&userno="+userno+"&mobileno="+mobileno ;
                     }else{
                    	  $('#err').html("<br />该用户不存在");
                          $('#userno').focus();
                     }
                 }
             });  
      }
  }
function checkOpenID(openId){
	
	 if(null==openId || ""==openId) {
        $('#err').html("<br />无法获取openID,请刷新页面");
        $('#userno').focus();
        return false;
	 }
	 return true;
}
 function check_login() {
    var userno = $('#userno').val();
    var mobileno = $('#mobileno').val();
    
    if (userno == '') {
        $('#err').html("<br />请输入用水户号");
        $('#userno').focus();
        return false;
    }
   
    var regex = /^\d{8}$/;
    if (!regex.test(userno)) {
        $('#err').html("<br />请输入8位数字组成的户号！");
        $('#userno').focus();
        return false;
    }
    if (mobileno == '') {
        $('#err').html("<br />请输入手机号码");
        $('#mobileno').focus();
        return false;
    }
    var regex = /^\d{11}$/;
    if (!regex.test(mobileno)) {
        $('#err').html("<br />请输入11位手机号码！");
        $('#mobileno').focus();
        return false;
    }
     $('#err').html("");
     return true;
}
